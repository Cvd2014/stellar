<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='utf-8'>


    <link href='stylesheets/bootstrap.min.css' rel='stylesheet' type='text/css'>
    <link href='stylesheets/dc.css' rel='stylesheet' type='text/css'>


</head>
<body>
<div class='container' id='main-container'>
    <div class='content'>
        <div class='container' style='font: 10px sans-serif;'>
            <div class='row-fluid'>
                <div class='remaining-graphs span8'>
                    <div class='row-fluid'>
                        <div class='bubble-graph span12' id='dc-bubble-graph'>
                            <h4>Average Rating (x-axis), Average Number of Reviews (y-axis), Number of Business'
                                (Size)</h4>
                        </div>
                    </div>
                    <div class='row-fluid'>
                    </div>
                    <div class='row-fluid'>
                    </div>
                </div>
                <div class='remaining-graphs span4'>
                </div>
            </div>
        </div>
    </div>
</div>
<script src='javascripts/d3.js' type='text/javascript'></script>
<script src='javascripts/crossfilter.js' type='text/javascript'></script>
<script src='javascripts/dc.js' type='text/javascript'></script>
<script src='javascripts/jquery.min.js' type='text/javascript'></script>
<script src='javascripts/bootstrap.min.js' type='text/javascript'></script>
<script type='text/javascript'>


    var chart_data = [{
                "city": "Ahwatukee",
                "review_count": 3,
                "name": "McDonald's",
                "neighborhoods": [],
                "type": "business",
                "business_id": "LNdwp-9Isnd6xmBKUz4K_A",
                "full_address": "10823 S 51st St\nAhwatukee, AZ 85044",
                "state": "AZ",
                "longitude": -111.975004,
                "stars": 2.0,
                "latitude": 33.348560900000003,
                "open": true,
                "categories": [
                    "Burgers",
                    "Fast Food",
                    "Restaurants"
                ]
            },
                {
                    "city": "Anthem",
                    "review_count": 3,
                    "name": "Calvin Klein",
                    "neighborhoods": [],
                    "type": "business",
                    "business_id": "-ZUEwUytc63ZWvgXJz7gHQ",
                    "full_address": "4250 W Anthem Way\nSte 100\nAnthem, AZ 85086",
                    "state": "AZ",
                    "longitude": -112.1502292,
                    "stars": 3.5,
                    "latitude": 33.873871800000003,
                    "open": true,
                    "categories": [
                        "Women's Clothing",
                        "Men's Clothing",
                        "Fashion",
                        "Shopping",
                        "Accessories"
                    ]
                }
                ,
                {
                    "city": "Anthem",
                    "review_count": 3,
                    "name": "Fox Designs Studio",
                    "neighborhoods": [],
                    "type": "business",
                    "business_id": "NHBfYwGcQk5RUVCbnpWRsg",
                    "full_address": "42104 N Venture Dr\nBldg C-110, Ste 112\nAnthem, AZ 85086",
                    "state": "AZ",
                    "longitude": -112.141987,
                    "stars": 3.5,
                    "latitude": 33.867223000000003,
                    "open": true,
                    "categories": [
                        "Web Design",
                        "Professional Services"
                    ]
                }
                ,
                {
                    "city": "Apache Junction",
                    "review_count": 3,
                    "name": "Dairy Queen",
                    "neighborhoods": [],
                    "type": "business",
                    "business_id": "zvFhC2Lywo6e8UaRTVj7sw",
                    "full_address": "2290 N Apache Drive\nApache Junction, AZ 85220",
                    "state": "AZ",
                    "longitude": -111.54880900000001,
                    "stars": 3.5,
                    "latitude": 33.435696,
                    "open": true,
                    "categories": [
                        "Restaurants"
                    ]
                }
                ,
                {
                    "city": "Apache Junction",
                    "review_count": 3,
                    "name": "Mediacom",
                    "neighborhoods": [],
                    "type": "business",
                    "business_id": "tgFTrk5o3_TxwokIlLxOKQ",
                    "full_address": "879 N Plaza Drive\nApache Junction, AZ 85220",
                    "state": "AZ",
                    "longitude": -111.549409,
                    "stars": 1.0,
                    "latitude": 33.42315,
                    "open": true,
                    "categories": [
                        "Professional Services",
                        "Electronics",
                        "Shopping",
                        "Home Services",
                        "Internet Service Providers"
                    ]
                }
                ,
                {
                    "city": "Apache Junction",
                    "review_count": 3,
                    "name": "Papa Murphy's",
                    "neighborhoods": [],
                    "type": "business",
                    "business_id": "zOayTVSvtaWDt8pWH1N6OQ",
                    "full_address": "2114 W Apache Trl\nApache Junction, AZ 85220",
                    "state": "AZ",
                    "longitude": -111.5689769,
                    "stars": 3.5,
                    "latitude": 33.415350599999996,
                    "open": true,
                    "categories": [
                        "Pizza",
                        "Restaurants"
                    ]
                }
                ,
                {
                    "city": "Apache Junction",
                    "review_count": 3,
                    "name": "VCA Apache Junction Animal Hospital",
                    "neighborhoods": [],
                    "type": "business",
                    "business_id": "yfjnV2wQb5oK9k0xBZZ06w",
                    "full_address": "17 N Mountain Road\nApache Junction, AZ 85220",
                    "state": "AZ",
                    "longitude": -111.58886800000001,
                    "stars": 2.5,
                    "latitude": 33.415880000000001,
                    "open": true,
                    "categories": [
                        "Pet Services",
                        "Veterinarians",
                        "Pet Boarding/Pet Sitting",
                        "Pets"
                    ]
                }
                ,
                {
                    "city": "Avondale",
                    "review_count": 13,
                    "name": "Jimmy John's",
                    "neighborhoods": [],
                    "type": "business",
                    "business_id": "6q1-3EtHXk2bFyANIxA11g",
                    "full_address": "10110 W McDowell Rd\nSte 100\nAvondale, AZ 85392",
                    "state": "AZ",
                    "longitude": -112.277288,
                    "stars": 3.5,
                    "latitude": 33.465255300000003,
                    "open": true,
                    "categories": [
                        "Food",
                        "Food Delivery Services",
                        "Delis",
                        "Sandwiches",
                        "Restaurants"
                    ]
                }
                ,
                {
                    "city": "Avondale",
                    "review_count": 3,
                    "name": "Crystal Springs",
                    "neighborhoods": [],
                    "type": "business",
                    "business_id": "RPgsrBEcc4NWlvnaW4Hwxg",
                    "full_address": "11885 W McDowell Rd\nAvondale, AZ 85323",
                    "state": "AZ",
                    "longitude": -112.31404379999999,
                    "stars": 3.5,
                    "latitude": 33.463396899999999,
                    "open": true,
                    "categories": [
                        "Home Services",
                        "Real Estate",
                        "Apartments"
                    ]
                }
                ,
                {
                    "city": "Avondale",
                    "review_count": 3,
                    "name": "East Asian Bistro",
                    "neighborhoods": [],
                    "type": "business",
                    "business_id": "qYO1UwChd4EKLtGGR7BquA",
                    "full_address": "3145 N Dysart Rd\nSte 102\nAvondale, AZ 85392",
                    "state": "AZ",
                    "longitude": -112.34085109999999,
                    "stars": 2.5,
                    "latitude": 33.482389300000001,
                    "open": true,
                    "categories": [
                        "Cafes",
                        "Asian Fusion",
                        "Restaurants"
                    ]
                }
                ,
                {
                    "city": "Avondale",
                    "review_count": 3,
                    "name": "Jack-In-the Box Drive Thru",
                    "neighborhoods": [],
                    "type": "business",
                    "business_id": "FosnBEgugCZfnvBwQbZPSA",
                    "full_address": "13088 W Rancho Santa Fe Boulevard\nAvondale, AZ 85323",
                    "state": "AZ",
                    "longitude": -112.3404381,
                    "stars": 3.0,
                    "latitude": 33.461222999999997,
                    "open": true,
                    "categories": [
                        "Restaurants"
                    ]
                }
                ,
                {
                    "city": "Avondale",
                    "review_count": 3,
                    "name": "Sam's Club",
                    "neighborhoods": [],
                    "type": "business",
                    "business_id": "jli7Qqj43zUnmt622tMHYg",
                    "full_address": "1459 N Dysart Rd\nAvondale, AZ 85323",
                    "state": "AZ",
                    "longitude": -112.339016,
                    "stars": 3.0,
                    "latitude": 33.452449000000001,
                    "open": true,
                    "categories": [
                        "Food",
                        "Grocery",
                        "Shopping",
                        "Electronics"
                    ]
                }
                ,
                {
                    "city": "Avondale",
                    "review_count": 3,
                    "name": "Walgreens",
                    "neighborhoods": [],
                    "type": "business",
                    "business_id": "oeGNIi1XEjpEXb8D5HdEFA",
                    "full_address": "10705 W Indian School Rd\nAvondale, AZ 85392",
                    "state": "AZ",
                    "longitude": -112.2910074,
                    "stars": 2.5,
                    "latitude": 33.493012499999999,
                    "open": true,
                    "categories": [
                        "Shopping",
                        "Drugstores",
                        "Beauty & Spas",
                        "Food",
                        "Convenience Stores",
                        "Cosmetics & Beauty Supply"
                    ]
                }
                ,
                {
                    "city": "Avondale",
                    "review_count": 4,
                    "name": "International House of Pancakes",
                    "neighborhoods": [],
                    "type": "business",
                    "business_id": "VFi-N5ySGpId7-ie85rSHQ",
                    "full_address": "1491 N Dysart Road\nAvondale, AZ 85323",
                    "state": "AZ",
                    "longitude": -112.3403335,
                    "stars": 3.0,
                    "latitude": 33.456347000000001,
                    "open": true,
                    "categories": [
                        "Restaurants"
                    ]
                }
                ,
                {
                    "city": "Avondale",
                    "review_count": 4,
                    "name": "Rusty Wallace Racing Experience- Phoenix International Raceway",
                    "neighborhoods": [],
                    "type": "business",
                    "business_id": "Ap8cykRoMrYRTBbX02aVYw",
                    "full_address": "125 South Avondale Blvd # 200\nAvondale, AZ 85323",
                    "state": "AZ",
                    "longitude": -112.305042,
                    "stars": 4.0,
                    "latitude": 33.445568999999999,
                    "open": true,
                    "categories": [
                        "Active Life",
                        "Amusement Parks"
                    ]
                }
                ,
                {
                    "city": "Avondale",
                    "review_count": 4,
                    "name": "Sweet Touch Carpet Cleaners",
                    "neighborhoods": [],
                    "type": "business",
                    "business_id": "z5UrjCSsJL625QLJFyrbeA",
                    "full_address": "10763 W Washington St\nAvondale, AZ 85323",
                    "state": "AZ",
                    "longitude": -112.290989,
                    "stars": 5.0,
                    "latitude": 33.446550999999999,
                    "open": true,
                    "categories": [
                        "Local Services",
                        "Carpet Cleaning"
                    ]
                }
                ,
                {
                    "city": "Avondale",
                    "review_count": 44,
                    "name": "Greek Gyro Express",
                    "neighborhoods": [],
                    "type": "business",
                    "business_id": "CckmnbRINaLB4Aaq1dAFCQ",
                    "full_address": "1467 N Dysart Rd\nSte 107\nAvondale, AZ 85323",
                    "state": "AZ",
                    "longitude": -112.345359,
                    "stars": 4.0,
                    "latitude": 33.430534999999999,
                    "open": true,
                    "categories": [
                        "Greek",
                        "Restaurants"
                    ]
                }
                ,
                {

                    "city": "Buckeye",
                    "review_count": 3,
                    "name": "Club Tan",
                    "neighborhoods": [],
                    "type": "business",
                    "business_id": "ONpk2xjLHnIVJksYzOEReQ",
                    "full_address": "1300 S Watson Road\nBuckeye, AZ 85326",
                    "state": "AZ",
                    "longitude": -112.5563745,
                    "stars": 5.0,
                    "latitude": 33.434010000000001,
                    "open": true,
                    "categories": [
                        "Tanning",
                        "Beauty & Spas"
                    ]
                }
                ,
                {
                    "city": "Buckeye",
                    "review_count": 3,
                    "name": "Copper Canyon Golf Club",
                    "neighborhoods": [],
                    "type": "business",
                    "business_id": "oZmGpuygmViMCc27CerS7Q",
                    "full_address": "26577 W Desert Vista Blvd\nBuckeye, AZ 85396",
                    "state": "AZ",
                    "longitude": -112.6229986,
                    "stars": 3.0,
                    "latitude": 33.665881400000004,
                    "open": true,
                    "categories": [
                        "Active Life",
                        "Golf"
                    ]
                }
                ,
                {
                    "city": "Buckeye",
                    "review_count": 3,
                    "name": "Estrella Kathy's Nails",
                    "neighborhoods": [],
                    "type": "business",
                    "business_id": "sPXs-DYlqf4DdRdIF0N9WA",
                    "full_address": "6213 S Miller Rd\nBuckeye, AZ 85326",
                    "state": "AZ",
                    "longitude": -112.5907571,
                    "stars": 1.5,
                    "latitude": 33.355013499999998,
                    "open": true,
                    "categories": [
                        "Beauty & Spas",
                        "Nail Salons"
                    ]
                },
                {
                    "city": "Wickenburg",
                    "review_count": 15,
                    "name": "Avi's Screamers Drive In",
                    "neighborhoods": [],
                    "type": "business",
                    "business_id": "7xnzVnCLsbBwfoRemL4NMQ",
                    "full_address": "1151 W Wickenburg Way\nWickenburg, AZ 85390",
                    "state": "AZ",
                    "longitude": -112.75273900000001,
                    "stars": 4.0,
                    "latitude": 33.963918999999997,
                    "open": true,
                    "categories": [
                        "Burgers",
                        "Restaurants"
                    ]
                }
                ,
                {
                    "city": "Wickenburg",
                    "review_count": 3,
                    "name": "Del E Webb Center For The Performing Arts",
                    "neighborhoods": [],
                    "type": "business",
                    "business_id": "GsdTYgE4GqHYTTnA9v9J0Q",
                    "full_address": "1090 S Vulture Mine Rd\nWickenburg, AZ 85390",
                    "state": "AZ",
                    "longitude": -112.7780683,
                    "stars": 4.5,
                    "latitude": 33.954050899999999,
                    "open": true,
                    "categories": [
                        "Arts & Entertainment"
                    ]
                }
                ,
                {
                    "city": "Wickenburg",
                    "review_count": 3,
                    "name": "Hassayampa River Preserve",
                    "neighborhoods": [],
                    "type": "business",
                    "business_id": "lx__YjGOYxuIeK2VsTUfEg",
                    "full_address": "49614 US Hwy 60 89\nWickenburg, AZ 85390",
                    "state": "AZ",
                    "longitude": -112.69029999999999,
                    "stars": 4.5,
                    "latitude": 33.933013199999998,
                    "open": true,
                    "categories": [
                        "Active Life"
                    ]
                }
                ,
                {
                    "city": "Wickenburg",
                    "review_count": 3,
                    "name": "Taco Bell",
                    "neighborhoods": [],
                    "type": "business",
                    "business_id": "RrI7eg0TZtdwCpXBWHTo3A",
                    "full_address": "528 E Wickenburg Way\nWickenburg, AZ 85390",
                    "state": "AZ",
                    "longitude": -112.72093510000001,
                    "stars": 3.5,
                    "latitude": 33.968934099999998,
                    "open": true,
                    "categories": [
                        "Pizza",
                        "Restaurants"
                    ]
                }
                ,
                {
                    "city": "Wickenburg",
                    "review_count": 6,
                    "name": "Ike's Cook Shack",
                    "neighborhoods": [],
                    "type": "business",
                    "business_id": "J4WPiHHlzqrKH4amrFxefA",
                    "full_address": "442 W Wickenburg Way\nWickenburg, AZ 85390",
                    "state": "AZ",
                    "longitude": -112.723653316498,
                    "stars": 4.0,
                    "latitude": 33.972121613488,
                    "open": true,
                    "categories": [
                        "Breakfast & Brunch",
                        "American (Traditional)",
                        "Restaurants"
                    ]
                }
            ]
            ;


    d3.json("data.json", function (yelp_data) {


        var bubbleChart = dc.bubbleChart("#dc-bubble-graph");


        var ndx = crossfilter(chart_data);

        var cityDimension = ndx.dimension(function (d) {
            return d.city;
        });
        var cityGroup = cityDimension.group();
        var cityDimensionGroup = cityDimension.group().reduce(
                //add
                function (p, v) {
                    ++p.count;
                    p.review_sum += v.review_count;
                    p.star_sum += v.stars;
                    p.review_avg = p.review_sum / p.count;
                    p.star_avg = p.star_sum / p.count;
                    return p;
                },
                //remove
                function (p, v) {
                    --p.count;
                    p.review_sum -= v.review_count;
                    p.star_sum -= v.stars;
                    p.review_avg = p.review_sum / p.count;
                    p.star_avg = p.star_sum / p.count;
                    return p;
                },
                //init
                function (p, v) {
                    return {count: 0, review_sum: 0, star_sum: 0, review_avg: 0, star_avg: 0};
                }
        );


        bubbleChart.width(650)
                .height(300)
                .dimension(cityDimension)
                .group(cityDimensionGroup)
                .transitionDuration(1500)
                .colors(["#a60000", "#ff0000", "#ff4040", "#ff7373", "#67e667", "#39e639", "#00cc00"])
                .colorDomain([-12000, 12000])

                .x(d3.scale.linear().domain([0, 5.5]))
                .y(d3.scale.linear().domain([0, 5.5]))
                .r(d3.scale.linear().domain([0, 2500]))
                .keyAccessor(function (p) {
                    return p.value.star_avg;
                })
                .valueAccessor(function (p) {
                    return p.value.review_avg;
                })
                .radiusValueAccessor(function (p) {
                    return p.value.count;
                })
                .transitionDuration(1500)
                .elasticY(true)
                .yAxisPadding(1)
                .xAxisPadding(1)
                .label(function (p) {
                    return p.key;
                })
                .renderLabel(true)
                .renderlet(function (chart) {
                    rowChart.filter(chart.filter());
                })
                .on("postRedraw", function (chart) {
                    dc.events.trigger(function () {
                        rowChart.filter(chart.filter());
                    });
                });


        dc.renderAll();
    });


</script>
</body>
</html>